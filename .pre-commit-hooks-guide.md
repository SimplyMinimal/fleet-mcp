# Pre-commit Hooks Quick Reference

This document provides a quick reference for using pre-commit hooks in the Fleet MCP project.

## Installation

After cloning the repository:

```bash
# Install dependencies (includes pre-commit)
uv sync --dev

# Install the git hooks
uv run pre-commit install
```

## What Happens Automatically

Once installed, pre-commit hooks run automatically before each `git commit`. They will:

1. **Auto-fix** formatting issues (Black, isort, trailing whitespace, etc.)
2. **Check** for type errors (mypy)
3. **Validate** YAML, TOML, and other file formats

If auto-fixes are applied, you'll need to:
- Review the changes
- Stage the fixed files: `git add <files>`
- Commit again: `git commit`

If type errors are found, you must fix them manually before committing.

## Manual Usage

### Run all hooks on all files
```bash
uv run pre-commit run --all-files
```

### Run all hooks on staged files only
```bash
uv run pre-commit run
```

### Run a specific hook on all files
```bash
uv run pre-commit run black --all-files
uv run pre-commit run isort --all-files
uv run pre-commit run mypy --all-files
```

### Run hooks on specific files
```bash
uv run pre-commit run --files src/fleet_mcp/client.py
```

## Updating Hooks

To update hooks to their latest versions:

```bash
uv run pre-commit autoupdate
```

## Bypassing Hooks (Not Recommended)

To commit without running hooks (CI will still check):

```bash
git commit --no-verify -m "Your message"
```

**Warning**: This is not recommended. Fix issues locally instead.

## Hooks Configured

1. **General File Checks**
   - Remove trailing whitespace
   - Fix end-of-file newlines
   - Validate YAML/JSON/TOML syntax
   - Check for large files (>1MB)
   - Detect merge conflicts

2. **Black** (auto-fixes)
   - Formats Python code
   - Line length: 88 characters
   - Files: `src/` and `tests/`

3. **isort** (auto-fixes)
   - Sorts and organizes imports
   - Black-compatible profile
   - Files: `src/` and `tests/`

4. **mypy** (checks only)
   - Type checking
   - Files: `src/` only (not tests)
   - Must pass for commit to succeed

## Troubleshooting

### Hook fails with "command not found"
Re-install the hooks:
```bash
uv run pre-commit clean
uv run pre-commit install
```

### Hooks are slow on first run
Pre-commit creates isolated environments for each hook. The first run downloads and installs dependencies. Subsequent runs are much faster.

### Want to skip a specific hook temporarily
Edit `.pre-commit-config.yaml` and add the hook ID to the `skip` list under the `ci:` section, or use:
```bash
SKIP=mypy git commit -m "Your message"
```

### Mypy errors that don't appear when running `uv run mypy src`
The pre-commit mypy environment is isolated. If you update dependencies, you may need to:
```bash
uv run pre-commit clean
uv run pre-commit install --install-hooks
```

## Configuration Files

- `.pre-commit-config.yaml` - Pre-commit hook configuration
- `pyproject.toml` - Tool configurations (Black, isort, mypy)

## CI Integration

The same checks run in CI (`.github/workflows/ci.yml`):
- Black formatting check
- isort import sorting check
- mypy type checking

Pre-commit hooks help catch issues before pushing to CI.

## More Information

- [Pre-commit documentation](https://pre-commit.com/)
- [Contributing Guide](CONTRIBUTING.md)
